\section{Long Output scheme}

Here we describe the scheme between the classical client and an honest quantum server. We mostly follow the logic in \cite{mahadev_delegation}. We first follow \cite{kempe_kitaev_regev_2006} to reduce the problem to an instance of local Hamiltonian.

We pick our universal gate set to be Hadamard gate and controlled phase gate following \cite{quant-ph/0301040}:
$$H=\frac{1}{\sqrt{2}}\begin{pmatrix}1&1\\1&-1\end{pmatrix}$$
$$\Lambda(P(i))=\begin{pmatrix}1&0&0&0\\0&1&0&0\\0&0&1&0\\0&0&0&i\end{pmatrix}$$
This set is proven to be universal in \cite{kitaev_1997}.

\subsection{preprocess the circuit}

Here we first reduce the circuit to real gates and states only. The proof is taken from \cite{quant-ph/0301040}.

We consider the transform $T\ket{\psi}=\ket{0}\otimes\Re\ket{\psi}+\ket{1}\otimes\Im\ket{\psi}$, where $\Re$ and $\Im$ denote real and imaginary parts respectively. To simplify some notations, let $\ket{\psi}$ be 1-indexed, and let the added qubit be the 0th. Note that after this transformation, the state is real. This transformation preserves measurement results in the standard basis. Under the transform, Hadamard gates are unchanged, but controlled phase gates become a combination of Hadamard and Toffoli gates. Mathematically,
$$T\circ H_f=H_f\circ T$$
$$T\circ\Lambda_f(P(i)_s)=\Lambda_{f,s}(X_0)\Lambda_{f,s}(Z_0)\circ T=\Lambda_{f,s}(X_0)H_0\Lambda_{f,s}(X_0)H_0\circ T$$

We then double (TODO: maybe multiply by $\gamma>1$ instead of doubling?) the size of the circuit by padding identity matrices at the end. This is so that the final output has a higher chance to be measured in the final result in the following reduction.

After these transformations, let $x$ be the new circuit input, and $U_T...U_1$ be the circuit to evaluate.

\subsection{Constructing a local Hamiltonian instance}

We then attempt to construct a local Hamiltonian with ground state: $$\phi=\sum_{t=0}^TU_t...U_1\ket{x}\otimes\ket{\hat{t}}$$
We do so by ensuring states perpendicular to it have high eigenvalues. The basic construction comes from \cite{kitaev2002classical}. The simplification comes from \cite{biamonte_love_2008}.

First, we ensure that the invalid clock states have high eigenvalues.
$$H_{clock}=\sum_{t=1}^{T-1}\ket{01}\bra{01}_{t,t+1}$$
We also set $S_{legal}=\ker H_{clock}$. Note that $S_{legal}$ is precisely the valid clock states; that is, valid unary representations in the time register. Note that $H_{clock}$ can also be written in terms of linear combinations of tensors of $X$, $Z$, and $I$ gates.
$$H_{clock}=\frac{1}{4}((T-1)I + Z_1 - Z_T - \sum_t^{T-1}Z_tZ_{t+1})$$

Then, we ensure that 1-qubit gates are propagated properly. To do so, we set
	$$H_{prop1}=\sum_{t\in T_1}H_{prop,t}$$
	$$H_{prop,t}=I\otimes\ket{\widehat{t}}\bra{\widehat{t}}
		+I\otimes\ket{\widehat{t-1}}\bra{\widehat{t-1}}
		-U_t\otimes\ket{\widehat{t}}\bra{\widehat{t-1}}
		-U_t^\dagger\otimes\ket{\widehat{t-1}}\bra{\widehat{t}}$$

I probably need to explain why this works but I'll leave it for another day.

Let $S_{prop1}=\ker H_{prop1}$.
Then, $S_{prop1}$ has the following as basis:
\begin{itemize}
	\item $\ket{00}_{f_t,s_t}\ket{\xi_{00}}\otimes
		(\ket{\widehat{t}}+\ket{\widehat{t+1}}+\ket{\widehat{t+2}})$
	\item $\ket{01}_{f_t,s_t}\ket{\xi_{01}}\otimes
		(\ket{\widehat{t}}+\ket{\widehat{t+1}}-\ket{\widehat{t+2}})$
	\item $\ket{10}_{f_t,s_t}\ket{\xi_{10}}\otimes
		(\ket{\widehat{t}}-\ket{\widehat{t+1}}-\ket{\widehat{t+2}})$
	\item $\ket{11}_{f_t,s_t}\ket{\xi_{11}}\otimes
		(\ket{\widehat{t}}-\ket{\widehat{t+1}}+\ket{\widehat{t+2}})$
\end{itemize}

Also, if $t\in T_2$, that is, $t$ corresponds to a time step where $C_\phi$ is applied, then the following are true due to $C_\phi$ being surrounded by $Z$ gates:
\begin{itemize}
	\item $\ket{0}\bra{0}_{f_t}\otimes
		\ket{\widehat{t}}\bra{\widehat{t}}
		=(\ket{\widehat{t}}+\ket{\widehat{t+1}})
		(\bra{\widehat{t}}+\bra{\widehat{t+1}})$
	\item $\ket{1}\bra{1}_{f_t}\otimes
		\ket{\widehat{t}}\bra{\widehat{t}}
		=(\ket{\widehat{t}}-\ket{\widehat{t+1}})
		(\bra{\widehat{t}}-\bra{\widehat{t+1}})$
	\item $\ket{0}\bra{0}_{s_t}\otimes
		\ket{\widehat{t}}\bra{\widehat{t}}
		=(\ket{\widehat{t+1}}+\ket{\widehat{t+2}})
		(\bra{\widehat{t+1}}+\bra{\widehat{t+2}})$
	\item $\ket{1}\bra{1}_{s_t}\otimes
		\ket{\widehat{t}}\bra{\widehat{t}}
		=(\ket{\widehat{t+1}}-\ket{\widehat{t+2}})
		(\bra{\widehat{t+1}}-\bra{\widehat{t+2}})$
	\item $(\ket{00}\bra{00}_{f_t,s_t}
		+\ket{11}\bra{11}_{f_t,s_t})\otimes
		\ket{\widehat{t}}\bra{\widehat{t}}
		=(\ket{\widehat{t}}+\ket{\widehat{t+2}})
		(\bra{\widehat{t}}+\bra{\widehat{t+2}})$
	\item $(\ket{01}\bra{01}_{f_t,s_t}
		+\ket{10}\bra{10}_{f_t,s_t})\otimes
		\ket{\widehat{t}}\bra{\widehat{t}}
		=(\ket{\widehat{t}}-\ket{\widehat{t+2}})
		(\bra{\widehat{t}}-\bra{\widehat{t+2}})$
\end{itemize}

Similarly,
\begin{itemize}
	\item $\ket{0}\bra{0}_{f_t}\otimes
		\ket{\widehat{t-1}}\bra{\widehat{t-1}}
		=(\ket{\widehat{t-1}}+\ket{\widehat{t-2}})
		(\bra{\widehat{t-1}}+\bra{\widehat{t-2}})$
	\item $\ket{1}\bra{1}_{f_t}\otimes
		\ket{\widehat{t-1}}\bra{\widehat{t-1}}
		=(\ket{\widehat{t-1}}-\ket{\widehat{t-2}})
		(\bra{\widehat{t-1}}-\bra{\widehat{t-2}})$
	\item $\ket{0}\bra{0}_{s_t}\otimes
		\ket{\widehat{t-1}}\bra{\widehat{t-1}}
		=(\ket{\widehat{t-2}}+\ket{\widehat{t-3}})
		(\bra{\widehat{t-2}}+\bra{\widehat{t-3}})$
	\item $\ket{1}\bra{1}_{s_t}\otimes
		\ket{\widehat{t-1}}\bra{\widehat{t-1}}
		=(\ket{\widehat{t-2}}-\ket{\widehat{t-3}})
		(\bra{\widehat{t-2}}-\bra{\widehat{t-3}})$
	\item $(\ket{00}\bra{00}_{f_t,s_t}
		+\ket{11}\bra{11}_{f_t,s_t})\otimes
		\ket{\widehat{t-1}}\bra{\widehat{t-1}}
		=(\ket{\widehat{t-1}}+\ket{\widehat{t-3}})
		(\bra{\widehat{t-1}}+\bra{\widehat{t-3}})$
	\item $(\ket{01}\bra{01}_{f_t,s_t}
		+\ket{10}\bra{10}_{f_t,s_t})\otimes
		\ket{\widehat{t-1}}\bra{\widehat{t-1}}
		=(\ket{\widehat{t-1}}-\ket{\widehat{t-3}})
		(\bra{\widehat{t-1}}-\bra{\widehat{t-3}})$
\end{itemize}

Now we ensure the 1-qubit gates are applied properly. The naive way would be to set
	$$H_t=I\otimes\ket{\widehat t}\bra{\widehat t}
		+I\otimes\ket{\widehat{t-1}}\bra{\widehat{t-1}}
		-C_\phi\otimes\ket{\widehat t}\bra{\widehat{t-1}}
		-C_\phi^\dagger\otimes\ket{\widehat{t-1}}\bra{\widehat{t}}$$
	$$H'=\sum_{t\in T_2}H_t$$
	Equivalently, $H_t=$

	$\ket{00}\bra{00}_{f_t,s_t}\otimes
		(\ket{\widehat{t}}-\ket{\widehat{t-1}})
		(\bra{\widehat{t}}-\bra{\widehat{t-1}})+$

	$\ket{01}\bra{01}_{f_t,s_t}\otimes
		(\ket{\widehat{t}}-\ket{\widehat{t-1}})
		(\bra{\widehat{t}}-\bra{\widehat{t-1}})+$

	$\ket{10}\bra{10}_{f_t,s_t}\otimes
		(\ket{\widehat{t}}-\ket{\widehat{t-1}})
		(\bra{\widehat{t}}-\bra{\widehat{t-1}})+$

	$\ket{11}\bra{11}_{f_t,s_t}\otimes
		(\ket{\widehat{t}}+\ket{\widehat{t-1}})
		(\bra{\widehat{t}}+\bra{\widehat{t-1}})$

However, this cannot be turned into 2-local, so we change the coefficients and set 
	$$H_{prop2}=\sum_{t\in T_2}H_{prop2,t}$$

	$H_{prop2,t}=$

	$\ket{00}\bra{00}_{f_t,s_t}\otimes
		4(\ket{\widehat{t}}-\ket{\widehat{t-1}})
		(\bra{\widehat{t}}-\bra{\widehat{t-1}})+$

	$\ket{01}\bra{01}_{f_t,s_t}\otimes
		2(\ket{\widehat{t}}-\ket{\widehat{t-1}})
		(\bra{\widehat{t}}-\bra{\widehat{t-1}})+$

	$\ket{10}\bra{10}_{f_t,s_t}\otimes
		2(\ket{\widehat{t}}-\ket{\widehat{t-1}})
		(\bra{\widehat{t}}-\bra{\widehat{t-1}})+$

	$\ket{11}\bra{11}_{f_t,s_t}\otimes
		(\ket{\widehat{t}}+\ket{\widehat{t-1}})
		(\bra{\widehat{t}}+\bra{\widehat{t-1}})$
instead.

Now, if restricted to $S_{prop}$,

	$H_{prop2,t}=H_{qubit,t}+H_{time,t}=$
	$$(-2\ket{0}\bra{0}_{f_t}-2\ket{0}\bra{0}_{s_t}
		+\ket{1}\bra{1}_{f_t}+\ket{1}\bra{1}_{s_t})\otimes$$
	$$(\ket{\widehat{t}}\bra{\widehat{t-1}}+
		\ket{\widehat{t-1}}\bra{\widehat{t}})+$$
	$$(2\ket{0}\bra{0}_{f_t}+2\ket{0}\bra{0}_{s_t}
		+\ket{1}\bra{1}_{f_t}+\ket{1}\bra{1}_{s_t}
		-2\ket{01}\bra{01}_{f_t,s_t}
		-2\ket{10}\bra{10}_{f_t,s_t})\otimes$$
	$$(\ket{\widehat{t-1}}\bra{\widehat{t-1}}+
		\ket{\widehat{t}}\bra{\widehat{t}})$$


Lastly, we check if the input is right...
	$$H_{in}=\sum_{i=m+1}^N\ket{1}\bra{1}_i\otimes\ket{0}\bra{0}$$

Now we use the projection lemma here. This step is different now that $H_{out}$ is gone. I think $J_{in}$ gets dropped or something like that?

\subsection{2-local ZX Hamiltonians}

We then follow \cite{biamonte_love_2008} in writing each terms of $H$ into only $Z$ and $X$ measurements...

This probably involves some kind of basis arguments on the Hamiltonians and maybe some stuff that's a bit more ugly. This should not change the state. I'll have to write this out later...

\subsection{Checking computation}

We then follow \cite{mahadev_delegation}. That is, the server would commit copies of the ground state of the Hamiltonian for the classical client to measure. The client would check whether the computation is done correctly using a modified Hamiltonian from \cite{kempe_kitaev_regev_2006}. 

And then, this in fact involves some probabilistic analysis shenanigans that we haven't fully figured out yet.

\subsection{Getting the Output}

Thanks to having padded the circuit with identity matrices at the end, if we measured $T>\frac{T}{2}$ on the time register, we would know that the other registers include the output of the required quantum computation. Now I would analyze the chances of getting this right, maybe in terms of fidelity or in terms of distance between this measured distribution and the ideal distribution...


