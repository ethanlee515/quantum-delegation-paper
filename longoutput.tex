\section{Our Long Output Scheme}

Here we describe the scheme between the classical client and an honest quantum server. This is similar to the underlying construction for \cite{mahadev_delegation}. We first preprocess the circuit using tools such as \cite{quant-ph/0301040}. We then follow \cite{kitaev2002classical} to reduce the problem to an instance of local Hamiltonian. Using tools from \cite{PhysRevA.93.022326}, the local Hamiltonian is written in a simple form. Then, NYI cuz we're stuck.

\subsection{Picking universal gate set}

We pick our universal gate set to be Hadamard gate and controlled phase gate following \cite{quant-ph/0301040}:
$$H=\frac{1}{\sqrt{2}}\begin{pmatrix}1&1\\1&-1\end{pmatrix}$$
$$\Lambda(P(i))=\begin{pmatrix}1&0&0&0\\0&1&0&0\\0&0&1&0\\0&0&0&i\end{pmatrix}$$
Which is proven to be universal in \cite{kitaev_1997}.

\subsection{Creating Real Circuits}

Now consider a circuit $C=U_T\ldots U_1$, where $U_i\in\set{H, \Lambda(P(i))}$. Its input is classical $x$ of size $n$. Let $\ket\psi$ denote the initial state with $N$ qubits, containing $x$ possibly followed by ancilliaries.

We first reduce it to real gates and states only. The proof is taken from \cite{quant-ph/0301040}.

We consider the transform $\mathcal{F}(\ket{\phi})=\ket{0}\otimes\Re\ket{\phi}+\ket{1}\otimes\Im\ket{\phi}$, where $\Re$ and $\Im$ denote real and imaginary parts respectively. Note that after this transformation, the state is real. This transformation preserves measurement results in the standard basis. We apply it to $\ket\psi$.

The transform commutes with Hadamard gates on the respective qubit, but controlled phase gates become a combination of Hadamard and Toffoli gates. Mathematically,
$$\mathcal{F}\circ H_s=H_s\circ\mathcal{F}$$
$$\mathcal{F}\circ\Lambda_f(P(i)_s)=\Lambda^2_{f,s}(X_0Z_0)\circ\mathcal{F}=\Lambda^2_{f,s}(X_0)H_0\Lambda^2_{f,s}(X_0)H_0\circ\mathcal{F}$$
Where $\ket{\psi}$ is 1-indexed, and the added qubit is in the 0th position. We modify the circuit as appropriate to obtain $C'$ that has size $T'\leq 4T$. Its initial state is real, and all the gates are real. Which implies all the intermediate states as well as the output are real. Its input $x$ doesn't change, but the initial state $\ket{\psi'}$ is now size $N+1$.

\subsection{More Properties of the Gate Set}

First, we show that Toffoli and Hadamard matrices can be written in terms of Kronecker products of $X$, $Z$, and $I$.
$$H=\frac{1}{\sqrt{2}}(X+Z)$$
$$\Lambda^2_{1,2}(X_3)=\ket{11}\bra{11}\otimes X+(I-\ket{11}\bra{11})\otimes I$$
$$\ket{11}\bra{11}=I\otimes I+Z\otimes Z-I\otimes Z-Z\otimes I$$

To this effect, we also define $G=$... TODO define set of tensors of XZI

\subsection{Constructing a local Hamiltonian instance}

Let $C$ undergo the above two transforms so it has the following properties
\begin{itemize}
	\item All states are real (including initial, intermediate states, and output).
	\item Consists of only Hadamard and Toffoli gates
	\item The last $\gamma$ of the gates are all identity gates (can easily achieve by padding)
\end{itemize}

After these transformations, let $x$ be the new circuit input, and $U_T...U_1$ be the circuit to evaluate. Let $x_i$ denote the $i$th bit of $x$, and $|x|$ denote the number of the qubits in the circuit.

We then attempt to construct a local Hamiltonian with ground state that encodes the history of the computation: $$\phi=\sum_{t=0}^TU_t...U_1\ket{x}\otimes\ket{\hat{t}}$$
We do so by ensuring states perpendicular to it have high eigenvalues. The base construction comes from \cite{kitaev2002classical}. The simplification is taken from \cite{PhysRevA.78.012352}.

First, we ensure that the invalid clock states have high eigenvalues by applying the following Hamiltonian to the time register.
$$H_{clock}=\sum_{t=1}^{T-1}\ket{01}\bra{01}_{t,t+1}$$
Note that $H_{clock}$ can also be written in terms of linear combinations of tensors of $X$, $Z$, and $I$ gates.
$$H_{clock}=\frac{1}{4}(Z_1 - Z_T) + \frac{1}{4}\sum_{t=1}^{T-1}(I-Z_tZ_{t+1}) $$
This can be checked by fixing the first and last qubit, then doing induction on the number of switches.

Then, we ensure that the initial condition is set up correctly.
$$H_{in}=\sum_i^{|x|}(I-\ket{x_i}\bra{x_i})\otimes\ket{0}\bra{0}_1$$
The kernel of this is precisely where everything is set up consistently with $\phi$ in time step $t=0$. Furthermore, this can be written in terms of linear combinations of tensors of $X$, $Z$, and $I$ gates as
$$H_{in}=\frac{1}{4}\sum_{i=1}^{|x|}(I-(-1)^{x_i}Z_i)\otimes(I+Z_1)$$

Then, we ensure that the gates are applied correctly.
$$H_{prop}=\sum_{t\in T_1}H_{prop,t}$$
$$H_{prop,t}=I\otimes\ket{\widehat{t}}\bra{\widehat{t}}
	+I\otimes\ket{\widehat{t-1}}\bra{\widehat{t-1}}
	-U_t\otimes\ket{\widehat{t}}\bra{\widehat{t-1}}
	-U_t^\dagger\otimes\ket{\widehat{t-1}}\bra{\widehat{t}}$$

Next, we check that $H_{prop}\geq0$ by the following transform.

$$W=\sum_{j=0}^L U_j\ldots U_1\otimes\ket{j}\bra{j}$$
$$W^\dagger\phi=\sum_{t=0}^T\ket{x}\otimes\ket{\hat{t}}$$
$$W^\dagger H_{prop} W=
\begin{pmatrix}
	\frac{1}{2} & -\frac{1}{2} & & & &  \\
	-\frac{1}{2} & 1 & -\frac{1}{2} & & & \\
	& -\frac{1}{2} & 1 & \ddots & & \\
	& & \ddots & \ddots & -\frac{1}{2} & \\
	& & & -\frac{1}{2} & 1 & -\frac{1}{2} \\
	& & & & -\frac{1}{2} & \frac{1}{2}
\end{pmatrix}$$

According to \cite{2002quant.ph.10077A}, $H_{prop}\geq 0$ due to the above form being relevant to random walks.

We can also write $H$ as (TODO need to define).
Note that $U^\dagger=U$, since the gates are either Hadamard or Toffoli. Additionally, $\frac{1}{2}(I-Z_{t-1})$ annihilates time steps before $t-1$. $\frac{1}{2}(I+Z_{t+1})$ similarly annihilates steps $t+1$ and after.
$$H_{prop,t}=\frac{I}{4}\otimes(I-Z_{t-1})(I+Z_{t+1})-\frac{U}{4}\otimes(I-Z_{t-1})X_t(I+Z_{t+1})$$
Extra care must be taken for boundary cases.
$$H_{prop,1}=\frac{1}{2}(I+Z_2)-U_1\otimes\frac{1}{2}(X_1+X_1Z_2)$$
$$H_{prop,T}=\frac{1}{2}(I-Z_{t-1})-U_T\otimes\frac{1}{2}(X_T-Z_{T-1}X_T)$$

TODO maybe say more about this.
We also set $S_{legal}=\ker H_{clock}$. Note that $S_{legal}$ is precisely the valid clock states; that is, valid unary representations in the time register.

TODO Write down the final Hamiltonian. Possibly also the eigenvalue gap.

\subsection{Measuring}

Here we show that the Hamiltonians above can be written in a simple form.




\subsection{Checking computation}

Given $\ket\phi$, now we're interested in the value of $\braket{\phi|H|\phi}$. Here we follow \cite{PhysRevA.93.022326}.

We write $H$ as a linear combination of tensors of $I$, $X$, and $Z$.
$$H=\sum_S d_S S= \sum_S |d_S|\sgn(d_S)S$$
We then scale the Hamiltonian.
$$D=\sum_S|d_S|$$
$$p_S=\frac{|d_S|}{D}$$
$$H'=\frac{H}{D}=\sum_S p_S\sgn(d_S)S$$

Note that $H'$ is now a weighted sum of measurement operators. We also have $0\leq p_S\leq1$ and $\sum_S p_S=1$, so we can treat it as a probability distribution over the choice of $S$.
$$\braket{\phi|H'|\phi}=\sum_S p_S\sgn(d_S)\braket{\phi|S|\phi}=\E_S[\sgn(d_S)\braket{\phi|S|\phi}]$$
Which is simple to estimate by doing the measurements corresponding to $S$.
Note that $H'=0$, but the measurement result is $\pm1$, so clearly we do not have perfect completeness.

\subsection{Analysis and amplification}

We then follow \cite{mahadev_delegation}. That is, the server would commit copies of the ground state of the Hamiltonian for the classical client to measure.
The client would keep a single copy for output, and use the other copies to check whether the computation is done properly.

Take $p_0$ and $p_1$ to be the probability to measure $\sgn(d_S)\braket{\phi|S|\phi}=-1$ on $\ket\psi$ and $\ket\phi$ respectively, where $\phi$ is perpendicular to $\psi$. Obviously, $p_0=\frac{1}{2}$, and $p_1<\frac{1}{2}$... TODO Now what? Hypothesis testing...?

\subsection{Getting the Output}

Thanks to having padded the circuit with identity matrices at the end, if we measured $t>\frac{T}{2}$ on the time register, we would know that the other registers include the output of the required quantum computation. Now I would analyze the chances of getting this right, maybe in terms of fidelity or in terms of distance between this measured distribution and the ideal distribution...
