\section{Long Output scheme}

Here we describe the scheme between the classical client and an honest quantum server. This is similar to the underlying construction for \cite{mahadev_delegation}. We first preprocess the circuit using tools such as \cite{quant-ph/0301040}. We then follow \cite{kitaev2002classical} to reduce the problem to an instance of local Hamiltonian. Using tools from \cite{PhysRevA.93.022326}, the local Hamiltonian is written in a simple form. Then, NYI cuz we're stuck.

We pick our universal gate set to be Hadamard gate and controlled phase gate following \cite{quant-ph/0301040}:
$$H=\frac{1}{\sqrt{2}}\begin{pmatrix}1&1\\1&-1\end{pmatrix}$$
$$\Lambda(P(i))=\begin{pmatrix}1&0&0&0\\0&1&0&0\\0&0&1&0\\0&0&0&i\end{pmatrix}$$
Which is proven to be universal in \cite{kitaev_1997}.

\subsection{preprocess the circuit}

Here we first reduce the circuit to real gates and states only. The proof is taken from \cite{quant-ph/0301040}.

We consider the transform $T(\ket{\psi})=\ket{0}\otimes\Re\ket{\psi}+\ket{1}\otimes\Im\ket{\psi}$, where $\Re$ and $\Im$ denote real and imaginary parts respectively. Note that after this transformation, the state is real. This transformation preserves measurement results in the standard basis. Under the transform, Hadamard gates are unchanged, but controlled phase gates become a combination of Hadamard and Toffoli gates. Mathematically,
$$T\circ H=H\circ T$$
$$T\circ\Lambda_f(P(i)_s)=\Lambda^2_{f,s}(X_0Z_0)\circ T=\Lambda^2_{f,s}(X_0)H_0\Lambda^2_{f,s}(X_0)H_0\circ T$$
Where $\ket{\psi}$ is 1-indexed, and the added qubit is in the 0th position. 

We then double (TODO: maybe multiply by $\gamma>1$ instead of doubling?) the size of the circuit by padding identity matrices at the end. This is so that the final output has a higher chance to be measured in the final result in the following reduction.

After these transformations, let $x$ be the new circuit input, and $U_T...U_1$ be the circuit to evaluate. Let $x_i$ denote the $i$th bit of $x$, and $|x|$ denote the number of the qubits in the circuit.

\subsection{Constructing a local Hamiltonian instance}

We then attempt to construct a local Hamiltonian with ground state that encodes the history of the computation: $$\phi=\sum_{t=0}^TU_t...U_1\ket{x}\otimes\ket{\hat{t}}$$
We do so by ensuring states perpendicular to it have high eigenvalues. The base construction comes from \cite{kitaev2002classical}. The simplification is taken from \cite{PhysRevA.78.012352}.

First, we ensure that the invalid clock states have high eigenvalues by applying the following Hamiltonian to the time register.
$$H_{clock}=\sum_{t=1}^{T-1}\ket{01}\bra{01}_{t,t+1}$$
We also set $S_{legal}=\ker H_{clock}$. Note that $S_{legal}$ is precisely the valid clock states; that is, valid unary representations in the time register. Note that $H_{clock}$ can also be written in terms of linear combinations of tensors of $X$, $Z$, and $I$ gates.
$$H_{clock}=\frac{1}{4}(Z_1 - Z_T) + \frac{1}{4}\sum_{t=1}^{T-1}(I-Z_tZ_{t+1}) $$
This can be checked by fixing the first and last qubit, then doing induction on the number of switches.

Then, we ensure that the initial condition is set up correctly.
$$H_{in}=\sum_i^{|x|}(I-\ket{x_i}\bra{x_i})\otimes\ket{0}\bra{0}_1$$
The kernel of this is precisely where everything is set up consistently with $\phi$ in time step $t=0$. Furthermore, this can be written in terms of linear combinations of tensors of $X$, $Z$, and $I$ gates as
$$H_{in}=\frac{1}{4}\sum_{i=1}^{|x|}(I-(-1)^{x_i}Z_i)\otimes(I+Z_1)$$

TODO define $S_{in}$ when projection lemma is used

Then, we ensure that the gates are applied correctly.
$$H_{prop}=\sum_{t\in T_1}H_{prop,t}$$
$$H_{prop,t}=I\otimes\ket{\widehat{t}}\bra{\widehat{t}}
	+I\otimes\ket{\widehat{t-1}}\bra{\widehat{t-1}}
	-U_t\otimes\ket{\widehat{t}}\bra{\widehat{t-1}}
	-U_t^\dagger\otimes\ket{\widehat{t-1}}\bra{\widehat{t}}$$

It is easier to check that it works and is Hermitian and works as expected by a unitary change of basis.

$$W=\sum_{j=0}^L U_j\ldots U_1\otimes\ket{j}\bra{j}$$
$$W^\dagger\phi=\sum_{t=0}^T\ket{x}\otimes\ket{\hat{t}}$$
$$W^\dagger H_{prop} W=
\begin{pmatrix}
	\frac{1}{2} & -\frac{1}{2} & & & &  \\
	-\frac{1}{2} & 1 & -\frac{1}{2} & & & \\
	& -\frac{1}{2} & 1 & \ddots & & \\
	& & \ddots & \ddots & -\frac{1}{2} & \\
	& & & -\frac{1}{2} & 1 & -\frac{1}{2} \\
	& & & & -\frac{1}{2} & \frac{1}{2}
\end{pmatrix}$$

I probably need to say even more on why this works but TODO I'll leave it for another day. There's also a closed form to the second smallest eigenvalue above that is apparently related to random walks but I can't find the source at the moment.

Note that $U^\dagger=U$, since the gates are either Hadamard or Toffoli. Additionally, $\frac{1}{2}(I-Z_{t-1})$ annihilates time steps before $t-1$. $\frac{1}{2}(I+Z_{t+1})$ similarly annihilates steps $t+1$ and after.
So we can write
$$H_{prop,t}=\frac{I}{4}\otimes(I-Z_{t-1})(I+Z_{t+1})-\frac{U}{4}\otimes(I-Z_{t-1})X_t(I+Z_{t+1})$$
Extra care must be taken for boundary cases.
$$H_{prop,1}=\frac{1}{2}(I+Z_2)-U_1\otimes\frac{1}{2}(X_1+X_1Z_2)$$
$$H_{prop,T}=\frac{1}{2}(I-Z_{t-1})-U_T\otimes\frac{1}{2}(X_T-Z_{T-1}X_T)$$

TODO Write down the final Hamiltonian. Possibly also the eigenvalue gap.

TODO consider using the older construction with the angle between subspaces for better constants?

\subsection{Checking computation}

Given $\ket\phi$, now we're interested in the value of $\braket{\phi|H|\phi}$. Here we follow \cite{PhysRevA.93.022326}.

We write $H$ as a linear combination of tensors of $I$, $X$, and $Z$.
$$H=\sum_S d_S S$$
We then shift each term by an identity.
$$H'=H+I\sum_S|d_S|$$
$$=\sum_S|d_S|(I+\sgn(d_S)S)$$
$$=\sum_S2|d_S|P_S$$
Note that $P_S$ are in fact projections since $S$ all have eigenvalues $\pm1$. Now scale $H'$:
$$H''=\frac{1}{2|d_S|}H'=\sum_S\pi_S P_S$$
Note that $H''$ is now a weighted sum of projectors. We also have $0\leq\pi_S\leq1$ and $\sum_S \pi_S=1$, so we can define the corresponding probability distribution over the choice of $S$. Now we can write the following:
$$\braket{\phi|H''|\phi}=\sum_S\pi_S\braket{\phi|P_S|\phi}=\E_S[\braket{\phi|P_S|\phi}]$$
$$\braket{\phi|P_S|\phi}=\braket{\phi|\frac{1}{2}(I+\sgn(d_S)S)|\phi}=\frac{1}{2}(1+\sgn(d_S)\braket{\phi|S|\phi})$$
Which is simple to estimate by doing the measurements corresponding to $S$.

TODO so do we have perfect completeness or no?

\subsection{Analysis and amplification}

We then follow \cite{mahadev_delegation}. That is, the server would commit copies of the ground state of the Hamiltonian for the classical client to measure.

And then, this in fact involves some probabilistic analysis shenanigans that we haven't fully figured out yet.

\subsection{Getting the Output}

Thanks to having padded the circuit with identity matrices at the end, if we measured $t>\frac{T}{2}$ on the time register, we would know that the other registers include the output of the required quantum computation. Now I would analyze the chances of getting this right, maybe in terms of fidelity or in terms of distance between this measured distribution and the ideal distribution...
