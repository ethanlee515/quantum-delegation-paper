\section{Our Long Output Scheme}

Here we describe the scheme between the classical client and an honest quantum server. This is similar to the underlying construction for \cite{mahadev_delegation}. We first preprocess the circuit using tools such as \cite{quant-ph/0301040}. We then follow \cite{kitaev2002classical} to reduce the problem to an instance of local Hamiltonian. Using tools from \cite{PhysRevA.93.022326}, the local Hamiltonian is written in a simple form. Then, NYI cuz we're stuck.

\subsection{Preprocessing circuit}

We pick our universal gate set to be Hadamard gate and controlled phase gate following \cite{quant-ph/0301040}:
$$H=\frac{1}{\sqrt{2}}\begin{pmatrix}1&1\\1&-1\end{pmatrix}$$
$$\Lambda(P(i))=\begin{pmatrix}1&0&0&0\\0&1&0&0\\0&0&1&0\\0&0&0&i\end{pmatrix}$$
Which is proven to be universal in \cite{kitaev_1997}.

Now consider a circuit $C=U_T\ldots U_1$ with the following properties:
\begin{itemize}
	\item $U_i\in\set{H, \Lambda(P(i))}$
	\item Has initial state $\ket\psi$ with $n$ qubits
\end{itemize}

We first reduce it to use only real gates and states. The proof is taken from \cite{quant-ph/0301040}. We consider the transform
$$\mathcal{F}(\ket{\phi})=\ket{0}\otimes\Re\ket{\phi}+\ket{1}\otimes\Im\ket{\phi}$$
where $\Re$ and $\Im$ denote real and imaginary parts respectively. It has the following properties

\begin{itemize}
	\item $\forall\ket\phi$, $\mathcal{F}(\ket\phi)$ is real.
	\item Preserves $X$ and $Z$ measurement results
\end{itemize}

We now apply $\mathcal{F}$ to $\ket\psi$. To make the notation easier, let $\ket{\psi}$ be 1-indexed, and the $\mathcal{F}\ket{\psi}$ be 0-indexed, so corresponding qubits stay in the same position.

The transform commutes with Hadamard gates on the respective qubit, but controlled phase gates become a combination of Hadamard and Toffoli gates. Mathematically,
$$\mathcal{F}\circ H_s=H_s\circ\mathcal{F}$$
$$\mathcal{F}\circ\Lambda_f(P(i)_s)=\Lambda^2_{f,s}(X_0Z_0)\circ\mathcal{F}=\Lambda^2_{f,s}(X_0)H_0\Lambda^2_{f,s}(X_0)H_0\circ\mathcal{F}$$
We modify the circuit as appropriate to obtain $C'$ that has size $T'\leq 4T$. We prove a theorem about this circuit that we'll use later.

\begin{definition}
	Let $\mathcal{G}_{XZ}=\set{U_0\otimes U_1\otimes\ldots\otimes U_n|U_i\in\set{I,X,Z}}$.
\end{definition}

To simplify the notation, we may only write the qubits with $X$ and $Z$ operators when talking about members of $\mathcal{G}_{XZ}$.

\begin{theorem}
	$H,\Lambda^2(X)\in\spn\mathcal{G}_{XZ}$
\end{theorem}

\begin{proof}
	$$H=\frac{1}{\sqrt{2}}(X+Z)$$
	$$\Lambda^2_{1,2}(X_3)=\ket{11}\bra{11}\otimes X+(I-\ket{11}\bra{11})\otimes I$$
	$$\ket{11}\bra{11}=\frac{1}{4}(I\otimes I+Z\otimes Z-I\otimes Z-Z\otimes I)$$
\end{proof}

Let $C$ undergo the above transformations so it has the following properties
\begin{itemize}
	\item All states are real (including initial, intermediate states, and output).
	\item Consists of only Hadamard and Toffoli gates
	\item The last $\gamma$ of the gates are all identity gates (can easily achieve by padding)
\end{itemize}

\subsection{Constructing a local Hamiltonian instance}

Let $C$ be a circuit with the above properties. Define the following quantities.
\begin{itemize}
	\item $C=U_T\ldots U_1$
	\item Let $x$ be the circuit input. Which is classical.
	\item Let $y$ denote the initial state. That is, $x$ possibly concatenated with ancillaries.
	\item Let $y_i$ denote the $i$-th bit of $y$
	\item Let $n$ be the number of qubits in $C$
\end{itemize}

We then attempt to construct a local Hamiltonian with the following ground state that encodes the history of the computation: $$\psi_{circuit}=\sum_{t=0}^TU_t...U_1\ket{y}\otimes\ket{\hat{t}}$$
We do so by ensuring states perpendicular to it have high eigenvalues. The base construction comes from \cite{kitaev2002classical}. The simplification is taken from \cite{PhysRevA.78.012352}.

First, we ensure that the invalid clock states have high eigenvalues by applying the following Hamiltonian to the time register.
$$H_{clock}=\sum_{t=1}^{T-1}\ket{01}\bra{01}_{t,t+1}$$
As a sum of projections, clearly $H_{clock}\geq 0$. We shall also show that $H_{clock}\in\spn\mathcal{G}_{XZ}$.
$$H_{clock}=\frac{1}{4}(Z_1 - Z_T) + \frac{1}{4}\sum_{t=1}^{T-1}(I-Z_tZ_{t+1}) $$
This can be checked by fixing the first and last qubit, then doing induction on the number of switches.

Then, we ensure that the initial condition is set up correctly.
$$H_{in}=\sum_{i=1}^n(I-\ket{y_i}\bra{y_i})\otimes\ket{0}\bra{0}_1$$
The kernel of this is precisely where everything is set up consistently with $\phi$ in time step $t=0$. Furthermore, $H_{in}\in\spn\mathcal{G}_{XZ}$
$$H_{in}=\frac{1}{4}\sum_{i=1}^n(I-(-1)^{y_i}Z_i)\otimes(I+Z_1)$$

Then, we ensure that the gates are applied correctly.
$$H_{prop}=\sum_{t\in T_1}H_{prop,t}$$
$$H_{prop,t}=I\otimes\ket{\widehat{t}}\bra{\widehat{t}}
	+I\otimes\ket{\widehat{t-1}}\bra{\widehat{t-1}}
	-U_t\otimes\ket{\widehat{t}}\bra{\widehat{t-1}}
	-U_t^\dagger\otimes\ket{\widehat{t-1}}\bra{\widehat{t}}$$

Next, we check that $H_{prop}\geq0$ by the following transform.

$$W=\sum_{j=0}^L U_j\ldots U_1\otimes\ket{j}\bra{j}$$
$$W^\dagger\phi=\sum_{t=0}^T\ket{x}\otimes\ket{\hat{t}}$$
$$W^\dagger H_{prop} W=
\begin{pmatrix}
	\frac{1}{2} & -\frac{1}{2} & & & &  \\
	-\frac{1}{2} & 1 & -\frac{1}{2} & & & \\
	& -\frac{1}{2} & 1 & \ddots & & \\
	& & \ddots & \ddots & -\frac{1}{2} & \\
	& & & -\frac{1}{2} & 1 & -\frac{1}{2} \\
	& & & & -\frac{1}{2} & \frac{1}{2}
\end{pmatrix}$$

According to \cite{2002quant.ph.10077A}, $H_{prop}\geq 0$ due to the above form being relevant to random walks. Furthermore, the last nonzero eigenvalue of $H_{prop}$ is at least $\frac{1}{2(T+1)^2}$.

We can also write $H=\spn\mathcal{G}_{XZ}$. Note that $U^\dagger=U$, since the gates are either Hadamard or Toffoli. Additionally, $\frac{1}{2}(I-Z_{t-1})$ annihilates time steps before $t-1$. $\frac{1}{2}(I+Z_{t+1})$ similarly annihilates steps $t+1$ and after.
$$H_{prop,t}=\frac{I}{4}\otimes(I-Z_{t-1})(I+Z_{t+1})-\frac{U}{4}\otimes(I-Z_{t-1})X_t(I+Z_{t+1})$$
Extra care must be taken for boundary cases.
$$H_{prop,1}=\frac{1}{2}(I+Z_2)-U_1\otimes\frac{1}{2}(X_1+X_1Z_2)$$
$$H_{prop,T}=\frac{1}{2}(I-Z_{t-1})-U_T\otimes\frac{1}{2}(X_T-Z_{T-1}X_T)$$

Now we consider the kernels of the Hamiltonians we defined. Notice the following.
$$K_{clock}=\ker H_{clock}$$
$$K_{in}=\ker H_{in}$$
$$K_{prop}=\ker H_{prop}$$
$$K_{clock}\cap K_{in}\cap K_{prop}=\spn\set{\psi_{circuit}}$$
We now consider the space outside the desired state.
$$S=(\spn\set{\psi_{circuit}})^\bot$$
$$H_{clock}\big|_S,H_{in}\big|_S,H_{prop}\big|_S$$
To combine the Hamiltonians, we apply the projection lemma twice.
$$\exists J_{clock}
=\frac{\poly\left(\norm{H_{in}\big|_S}\right)}{\lambda\left(H_{clock}\big|_{S\cap K^\bot_{clock}}\right)}
=O(n)=O(T)$$
$$\lambda(H_{in}\big|_S+J_{clock}H_{clock}\big|_S)\geq
\lambda(H_{in}\big|_{S\cap K_{clock}})-\frac{1}{8}$$
$$\exists J_{prop}=\frac{\poly\left(\norm{H_{in}\big|_S+J_{clock}H_{clock}\big|_S}\right)}{\lambda\left(H_{prop}\big|_{S\cap K^\bot_{prop}}\right)}
=\frac{O(n+T)}{\Omega(T^{-2})}=O(T^3)$$
$$\lambda(H_{in}\big|_S+J_{clock}H_{clock}\big|_S+J_{prop}H_{prop}\big|_S)\geq
\lambda(H_{in}\big|_{S\cap K_{clock}\cap K_{prop}})-\frac{1}{4}$$
$$\Rightarrow\lambda((H_{in}+J_{clock}H_{clock}+J_{prop}H_{prop})\big|_S)\geq\frac{3}{4}$$
So we set $H_{circuit}=H_{in}+J_{clock}H_{clock}+J_{prop}H_{prop}$ to obtain the following properties.
\begin{itemize}
	\item $\braket{\psi_{circuit}|H_{circuit}|\psi_{circuit}}=0$
	\item $\braket{\phi|H_{circuit}|\phi}\geq\frac{3}{4}$ for $\ket\phi$ such that $\braket{\phi|\psi_{circuit}}=0$
	\item $H_{circuit}\in\spn\mathcal{G}_{XZ}$. There are $O(T)$ nonzero components, whose coefficients are each at most $O(T^3)$.
\end{itemize}

\subsection{Measuring ground state}

Given $\ket\phi$, now we're interested in the value of $\braket{\phi|H|\phi}$. Here we follow \cite{PhysRevA.93.022326}. Note that if $\phi=\psi_{circuit}$, then $\braket{\phi|H|\phi}=0$. If $\braket{\phi|\psi_{circuit}}=0$, then $\braket{\phi|H|\phi}>\frac{3}{4}$.

Since $H\in\spn\mathcal{G}_{XZ}$, we can write it as follows:
$$H=\sum_{S\in\mathcal{G}_{XZ}} d_S S= \sum_{S\in\mathcal{G}_{XZ}} |d_S|\sgn(d_S)S$$
We then scale the Hamiltonian.
$$D=\sum_{S\in\mathcal{G}_{XZ}}|d_S|$$
$$p_S=\frac{|d_S|}{D}=O(T^4)$$
$$H'=\frac{H}{D}=\sum_{S\in\mathcal{G}_{XZ}} p_S\sgn(d_S)S$$

Note that $H'$ is now a weighted sum of measurement operators. We also have $0\leq p_S\leq1$ and $\sum_{S\in\mathcal{G}_{XZ}} p_S=1$, so we can treat it as a probability distribution over the choice of $S$.
$$\braket{\phi|H'|\phi}=\sum_{S\in\mathcal{G}_{XZ}} p_S\sgn(d_S)\braket{\phi|S|\phi}=\E_S[\sgn(d_S)\braket{\phi|S|\phi}]$$
Which is simple to estimate by doing the measurements corresponding to $S$.
Note that $H'=0$, but the measurement result is $\pm1$, so clearly we do not have perfect completeness.

Now let $\ket\phi$ be such that $\braket{\phi|\psi_{circuit}}=0$.
Take $p_0$ and $p_1$ to be the probability to measure $\sgn(d_S)\braket{\phi|S|\phi}=1$ on $\ket\psi_{circuit}$ and $\ket\phi$ respectively.
$$p_0=\frac{1}{2}$$
$$\braket{\phi|H'|\phi}=\frac{1}{O(T^4)}\braket{\phi|H|\phi}=\Omega(T^{-4})$$
$$\Rightarrow p_1=\frac{1}{2}+\Omega(T^{-4})$$

\subsection{Analysis and amplification}

We then follow \cite{mahadev_delegation}. That is, the server would commit copies of the ground state of the Hamiltonian for the classical client to measure.
The client would keep a single copy for output, and use the other copies to check whether the computation is done properly.
TODO Now what? Hypothesis testing...?

\subsection{Getting the Output}

Thanks to having padded the circuit with identity matrices at the end, if we measured $t>\frac{T}{2}$ on the time register, we would know that the other registers include the output of the required quantum computation. Now I would analyze the chances of getting this right, maybe in terms of fidelity or in terms of distance between this measured distribution and the ideal distribution...
