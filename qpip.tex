\section{Delegation Protocol for Hybrid Client}

In this section, we construct a one-message $\QPIP_1$ delegation protocol for $\SampBQP$.
It is statistically secure with negligible completeness errors and inverse polynomial soundness errors.
At a high level idea, it is a cut-and-choose protocol.
The server constructs multiple copies of the ground state as certificates,
then the client randomly chooses a copy to output and checks the rest.

There are two main challenges to this cut-and-choose approach.
First, the client needs to reliably extract the circuit output from its corresponding ground state.
We accomplish this by padding the circuit with identity gates at the end.
By doing so, the clock register collapses to after the last non-identity gate with high probability.

The other challenge is that a cheating prover's copies of certificates can be arbitrarily entangled,
so the usual techniques such as Chernoff bounds cannot be applied as-is.
This isn't a challenge for our $\Piblind$ for $\BQP$ earlier because its soundness is one-sided:
we only guarantee that a client cannot accept a no-instance;
a cheating server is allowed to cause the client to reject a yes-instance.
Because of this asymmetry, a cheating prover's for $\Piblind$ optimal strategy is to maximize its acceptance probability,
which corresponds to sending $n$ identical copies of some state.
In our case with $\SampBQP$, we overcome this challenge by using de Finetti's theorem
to approximate our measurement results with that of measurement results on some unentangled copies.

\def\GS{\mathsf{GS}}
\nc{\PiGS}{\ensuremath{\Pi_\GS}}
\nc{\VGS}{\ensuremath{V_\GS}}
\nc{\PGS}{\ensuremath{P_\GS}}
\nc{\PGSstar}{\ensuremath{P_\GS^*}}
\nc{\cVGS}[1]{\ensuremath{\cV_{\GS,#1}}}
\nc{\cPGS}[1]{\ensuremath{\cP_{\GS,#1}}}

\def\Samp{\mathsf{Samp}}
\nc{\PiSamp}{\ensuremath{\Pi_\Samp}}
\nc{\VSamp}{\ensuremath{V_\Samp}}
\nc{\PSamp}{\ensuremath{P_\Samp}}
\nc{\PSampstar}{\ensuremath{P_\Samp^*}}
\nc{\cVSamp}[1]{\ensuremath{\cV_{\Samp,#1}}}
\nc{\cPSamp}[1]{\ensuremath{\cP_{\Samp,#1}}}

\def\GS{\mathsf{GS}}

Now we present our $\QPIP_1$ protocol. It is parametrized by $\lambda$, the degree of its inverse polynomial soundness.

\begin{protocol}{$\QPIP_1$ protocol $\PiSamp$ for $\SampBQP$}
	\label{ProtoQPIP1}
	Let $\varepsilon=\frac{1}{T^\lambda}$.
	Let $C'$ be $C$ padded with $T^{\lambda + 1}$ identity gates at the end.
	Let $n$ be large enough so by Chernoff bound:
		$$P\left[Bin(n, \frac{1}{2}-2\varepsilon)\geq\left(\frac{1}{2}-\varepsilon\right)n\right]<\varepsilon$$
		$$P\left[Bin(n, \frac{1}{2})\leq\left(\frac{1}{2}-\varepsilon\right)n\right]<\varepsilon$$
	Let $N$ be large enough so that de Finetti's theorem can be applied at the cost of $\varepsilon$ errors if one randomly picks $n+1$ subsystems out of $N$ permutation-invariant subsystems.
		That is,
		$$\sqrt{\frac{2(n+1)^2\ln\abs{A}}{N-(n+1)}}<\varepsilon$$
		where $\abs{A}$ is the number of qubits in $\ket{\psi_{C'(x)}}$
	\begin{enumerate}
		\item The verifier privately samples $I\subset[N]$ s.t. $\abs{I}=n$, and $k\xleftarrow{\$}[N]\setminus I$.
		\item The honest prover prepares $N$ copies of $\ket{\psi_{C'(x)}}$ and sends all of it to the verifier qubit-by-qubit.
		\item For $i$ from $1$ to $N$, the verifier chooses what to do to $\rho_i$ as follows:
		\begin{enumerate}
			\item If $i\in I$, run $\cA_{\GS}(\rho_i)$.
			\item Otherwise, if $i=k$, measure the data register of $\rho_i$ and save the outcome as $y$.
			\item Otherwise, discard $\rho_i$.
		\end{enumerate}
		\item If the proportion of copies accepted by $\cA_{\GS}$ is greater than $\frac{1}{2}-\varepsilon$ then the verifier accepts and outputs $y$. Otherwise, it rejects.
	\end{enumerate}
\end{protocol}

Note that $\VSamp$ only needs to apply $X$ and $Z$ measurements, and is classical otherwise. $\PiSamp$ has negligible completeness errors by construction. We now show its soundness.

\begin{thm}
    \label{QPIP1thm}
	$\PiSamp$ has $O(\frac{1}{T^\lambda})$ soundness error.
\end{thm}
\begin{prf}
	Suppose $\PSampstar$ is a cheating prover that sends some $\sigma$ to the verifier.

	We first show that de Finetti's theorem can be used here.

	Randomly picking $n+1$ out of $N$ registers is equivalent to first applying a random permutation then taking the first $n+1$ registers.
	A random permutation, in turn, is equivalent to a classical mix over all possible permutations of $\sigma$:

	$$\sigma'=\frac{1}{\abs{\Sym(N)}}\sum_{\Pi\in\Sym(N)}\Pi\sigma\Pi^\dagger$$

	Now we verify that $\sigma'$ is permutation-invariant.
	Let $\tilde{\Pi}$ be some fixed permutation, then clearly:
	$$\tilde{\Pi}\sigma'\tilde{\Pi}^\dagger=\sigma'$$

	Now we apply \cref{deFinetti}. $\exists\set{w_i, \rho_i}$ such that:
	$$\max_{\Lambda_i}\norm{\Lambda_1\otimes\ldots\otimes\Lambda_{m+n}(\sigma'-\sum_i w_i\rho_i^{\otimes n+m})}=O(\varepsilon)$$

	Note that $\tilde\sigma=\sum_i w_i\rho_i^{\otimes n+m}$ is a classical mix over $\rho_i^{\otimes n+m}$ with weights $w_i$.

	Let $p_i$ be the accept probability of at least $(\frac{1}{2}-\varepsilon)n$ copies from $\rho_i^{\otimes n}$ accept under \cref{AlgGroundStateCheck}.
	So the accept chance of this prover is $\sum_j w_j p_j>\delta$
	By Bayes' theorem, conditioned on acceptance, the probability of $\tilde{\sigma}$ being $\rho_i^{\otimes n+1}$ is then $\frac{w_i p_i}{\sum_j w_j p_j}$.

	Let
	$$J=\set{j:q_j\leq P\left[Bin(n, \frac{1}{2}-2\varepsilon)\geq\left(\frac{1}{2}-\varepsilon\right)n\right]}$$

	Recall that then each $q_j$ must be negligible by how we picked $n$. Hence the following is clearly negligible:
	$$\sum_{j\in J} w_j q_j$$

	And so is
	$$\frac{\sum_{j\in J} w_j q_j}{\sum_i w_i q_i}=\frac{\sum_{j\in J} w_j q_j}{\delta}$$

	So by Bayes' theorem, conditioned on acceptance, the probability of $\tilde{\sigma}$ being $\rho_i^{\otimes n+m}$ where $\rho_i$ has over probability $1-2\varepsilon$ to be accepted by \cref{AlgGroundStateCheck} is overwhelming.

	Such $\rho_i$ is $O(\negl(\varepsilon))$-close to $\ket{\psi_{C'(x)}}$, by applying a Chernoff bound to \cref{ThmXZCheck}.

	The probability of measuring $t<T$ on the clock register of $\ket{\psi_{C'(x)}}$ is $\frac{T}{T+T^{\lambda+1}}<\frac{1}{T^\lambda}=\varepsilon$,
	so the data register has $1-\varepsilon$ probability to be $C(x)$ at this point.

	All errors up to this point is $O(\varepsilon)$.
\end{prf}

