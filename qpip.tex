\section{Delegation Protocol for Hybrid Client}

\Ethan{Remark on amplification and doing this qubit-by-qubit by last section. Do some general story-telling.}

Here we create a $\QPIP_1$ scheme for $\SampBQP$ by constructing a history XZ local Hamiltonian instance, and ask the prover to provide the ground state. In the case of decision problems, it would be a simple Chernoff bound as in \cite{kitaev2002classical}. A prover, honest or not, couldn't do better than sending $n$ identical copies of some state. The same reasoning does not work in our case, so we give the following construction instead.

First, we make an observation.

\begin{observation}
	\label{ProtoGroundStateCheck}
	There is a $\QPIP_1$ protocol for \autoref{AlgGroundStateCheck}. Furthermore, in this protocol, the verifier doesn't need to apply any gates, and only needs to apply $X$ and $Z$ measurements.
\end{observation}
\begin{proof}
	The prover simply sends the input qubit-by-qubit for the verifier to measure. It is clear that any attacks on this scheme trivially maps onto an attack on the original scheme.
\end{proof}

Now we present \hyperref[ProtoQPIP1]{Protocol~\ref*{ProtoQPIP1}}, a $\QPIP_1$ protocol for any $\SampBQP$ problem with inverse polynomial error in circuit size.

\begin{protocol}{$\QPIP_1$ protocol for $\SampBQP$}
	\label{ProtoQPIP1}
	Take $\varepsilon>0$
	Let $m$ be large enough so that $\frac{1}{2^m}$ is negligible in $\varepsilon$
	Let $n$ be large enough so both $P\left[Bin(n, \frac{1}{2}-2\varepsilon)\geq\left(\frac{1}{2}-\varepsilon\right)n\right]$ and $P\left[Bin(n, \frac{1}{2})\leq\left(\frac{1}{2}-\varepsilon\right)n\right]$ are negligible in $\varepsilon$ by Chernoff bound
	Let $N$ be large enough so that $\sqrt{\frac{2(m+n)^2\ln\abs{A}}{N-(m+n)}}<\varepsilon$, where $\abs{A}$ is the number of qubits in $\ket{\psi_{C(x)}}$.
	\begin{enumerate}
		\item The honest prover sends $N$ identical copies of $\ket{\psi_{C'(x)}}$, where $C'$ is $C$ padded with identities as mentioned in \hyperref[idpadding]{Observation~\ref*{idpadding}}
		\item The verifier randomly picks $m$ copies for outputting and $n$ copies for checking
		\item Set up a counter $c=0$
		\item Set $y=\bot$
		\item For $i$ from $1$ to $N$:
		\begin{enumerate}
			\item If the $i$-th register is for checking:
			\begin{enumerate}
				\item The verifier runs \autoref{AlgGroundStateCheck} as described by \hyperref[ProtoGroundStateCheck]{Observation~\ref*{ProtoGroundStateCheck}}.
				\item If the test passes, increment counter $c$.
			\end{enumerate}
			\item If the register is for outputting:
			\begin{enumerate}
				\item The verifier measures the copy in standard basis
				\item If the measurement result of the clock register $\geq\frac{T}{2}$ and $y=\bot$, then update $y$ as the measurement result of the data register.
			\end{enumerate}
			\item Otherwise, just measure the entire register in standard basis and discard it.
		\end{enumerate}
		\item If $\frac{c}{n}\geq\frac{1}{2}-\varepsilon$:
		\begin{enumerate}
			\item If $y\ne\bot$ then output $y$
			\item Otherwise, reject.
		\end{enumerate}
		\item Otherwise, reject.
	\end{enumerate}
\end{protocol}

\begin{thm}
    \label{QPIP1thm}
	For any $L\in\SampBQP$, \hyperref[ProtoQPIP1]{Protocol~\ref*{ProtoQPIP1}} is a protocol for $L$ with negligible completeness. $\forall c\in\bbN$, it achieves soundness $(\varepsilon, \varepsilon)$ where $\varepsilon=T^{-c}$. Furthermore, in this protocol, the verifier doesn't need to apply any gates, and only needs to apply $X$ and $Z$ measurements.
\end{thm}
\begin{proof}
	It clearly has completeness negligibly close to $1$. Now we analyze soundness against a possibly cheating prover that has at least $\delta$ probability to be accepted. Let $\sigma$ be the state the prover sends to the verifier.

	Picking $n+m$ out of $N$ registers is equivalent to first applying a random permutation then taking the first $n+m$ registers.
	A random permutation is equivalent to a classical mix over all possible permutations of $\sigma$:

	$$\sigma'=\frac{1}{\abs{\Sym(N)}}\sum_{\Pi\in\Sym(N)}\Pi\sigma\Pi^\dagger$$

	Now we verify that $\sigma'$ is permutation-invariant.
	Let $\tilde{\Pi}$ be some fixed permutation, then clearly:
	$$\tilde{\Pi}\sigma'\tilde{\Pi}^\dagger=\sigma'$$

	So we can apply \autoref{deFinetti}. $\exists\set{w_i, \rho_i}$ such that:
	$$\max_{\Lambda_i}\norm{\Lambda_1\otimes\ldots\otimes\Lambda_{m+n}(\sigma'-\sum_i w_i\rho_i^{\otimes n+m})}=O(\varepsilon)$$

	Note that $\tilde\sigma=\sum_i w_i\rho_i^{\otimes n+m}$ is a classical mix over $\rho_i^{\otimes n+m}$ with weights $w_i$.

	Let $p_i$ be the accept probability of at least $(\frac{1}{2}-\varepsilon)n$ copies from $\rho_i^{\otimes n}$ accept under \autoref{AlgGroundStateCheck}.
	So the accept chance of this prover is $\sum_j w_j p_j>\delta$
	By Bayes' theorem, conditioned on acceptance, the probability of $\tilde{\sigma}$ being $\rho_i^{\otimes n+m}$ is then $\frac{w_i p_i}{\sum_j w_j p_j}$.

	Let
	$$J=\set{j:q_j\leq P\left[Bin(n, \frac{1}{2}-2\varepsilon)\geq\left(\frac{1}{2}-\varepsilon\right)n\right]}$$

	Recall that then each $q_j$ must be negligible by how we picked $n$. Hence the following is clearly negligible:
	$$\sum_{j\in J} w_j q_j$$

	And so is
	$$\frac{\sum_{j\in J} w_j q_j}{\sum_i w_i q_i}=\frac{\sum_{j\in J} w_j q_j}{\delta}$$

	So by Bayes' theorem, conditioned on acceptance, the probability of $\tilde{\sigma}$ being $\rho_i^{\otimes n+m}$ where $\rho_i$ has over probability $1-2\varepsilon$ to be accepted by \autoref{AlgGroundStateCheck} is overwhelming.

	Such $\rho_i$ is $O(\negl(\varepsilon))$-close to $\ket{\psi_{C'(x)}}$, by applying a Chernoff bound to \autoref{ThmXZCheck}.

	The probability of measuring $t\geq T$ on the clock register of $\ket{\psi_{C'(x)}}$ is $\frac{1}{2}$, so the probability of failing to do so after $m$ attempts is negligible.
	Once we do measure $t\geq T$, the data register is $C(x)$.

	All errors up to this point is $O(\varepsilon)$.
\end{proof}

