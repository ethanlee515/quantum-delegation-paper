\section{Our QPIP Scheme}

Here we create a $\QPIP_1$ scheme for $\SampBQP$ by constructing a history XZ local Hamiltonian instance, and ask the prover to provide the ground state. In the case for decision problems, it would be a simple Chernoff bound as in \cite{kitaev2002classical}. A prover, honest or not, couldn't do better than sending $n$ identical copies of some state. The same reasoning does not generalize to our case, so instead we give the following construction.

We then extend our scheme for $\QPIP_0$, by using results from \cite{mahadev_delegation}.

\subsection{TODO 1 qubit}

\Ethan{Fix title}

First, we make an observation.

\begin{observation}
	There is a $\QPIP_1$ protocol for \autoref{AlgGroundStateCheck}. Furthermore, in this protocol, the verifier doesn't need to apply any gates, and only needs to apply $X$ and $Z$ measurements.
	\Ethan{Maybe give the protocol a name then?}
\end{observation}
\begin{proof}
	The prover simply sends the input qubit-by-qubit for the verifier to measure. It is clear that any attacks on this scheme trivially maps onto an attack on the original scheme.
\end{proof}

\begin{theorem}
	Let $L\in\SampBQP$. Then there exists some $\QPIP_1$ protocol for $L$ with completeness negligible to perfect and soundness $(O(T^{-c}), 1-O(T^{-c}))$ for any constant $c$. Furthermore, in this protocol, the verifier doesn't need to apply any gates, and only needs to apply $X$ and $Z$ measurements.
\end{theorem}
\begin{proof}
	Set the following variables
	\begin{itemize}
		\item $\varepsilon=T^{-c}$
		\item $m$ large enough so that $\frac{1}{2^m}$ is negligible in $\varepsilon$
		\item $n$ large enough so by Chernoff bound:
			\begin{itemize}
				\item[$\circ$] $q'=P\left[Bin(n, \frac{1}{2}-2\varepsilon)\geq\left(\frac{1}{2}-\varepsilon\right)n\right]$ is negligible in $\varepsilon$
				\item[$\circ$] $P\left[Bin(n, \frac{1}{2})\leq\left(\frac{1}{2}-\varepsilon\right)n\right]$ is negligible in $\varepsilon$
			\end{itemize}
		\item $N$ large enough so that $\sqrt{\frac{2(m+n)^2\ln\abs{A}}{N-(m+n)}}<\varepsilon$, where $\abs{A}$ is the number of qubits in $\ket{\psi_{C(x)}}$.
	\end{itemize}

	We claim that \hyperref[ProtoQPIP1]{Protocol~\ref*{ProtoQPIP1}} does what is required.
	\floatname{algorithm}{Protocol}
	\begin{algorithm}
		\caption{Our $\QPIP_1$ protocol}
		\label{ProtoQPIP1}
		\begin{algorithmic}[1]
			\State The honest prover sends $N$ identical copies of $\ket{\psi_{C'(x)}}$, where $C'$ is $C$ padded with identities as mentioned in \hyperref[idpadding]{Observation~\ref*{idpadding}}
			\State The verifier randomly picks $n+m$ copies; $m$ for output and $n$ for checking
			\State $c\gets0$
			\For{$i\gets1, N$}
			    \If{Register is for checking}
			    \State The verifier runs \autoref{AlgGroundStateCheck} on the register
			    \If{Test passes}
			        $c\gets c+1$
			    \EndIf
			    \ElsIf{Register is for outputting}
			    \State The verifier measures the clock register
			    \If{measurement result $\geq\frac{T}{2}$}
			        \If{$y$ isn't set}
			            $y\gets$ Measure the data register
                    \EndIf
			    \EndIf
			    \Else
			    \State Measure the entire register in standard basis
			    \EndIf
			\EndFor
			\If{$\frac{c}{n}\geq\frac{1}{2}-\varepsilon$}
			\If{$y$ is set}
			\State output $y$
			\Else
			\State Reject
			\EndIf
			\Else
			\State Reject
			\EndIf
		\end{algorithmic}
	\end{algorithm}
	
	It clearly has completeness negligibly close to $1$. Now we analyze soundness against a possibly cheating prover that has at least $\delta$ probability to be accepted. Let $\sigma$ be the state the prover sends.

	Picking $n+m$ out of $N$ registers is equivalent to first applying a random permutation then taking the first $n+m$ registers.
	We can see a random permutation as a classical mix over all possible permutations of $\sigma$; mathematically, it can be written as:

	$$\sigma'=\frac{1}{\abs{\Sym(N)}}\sum_{\Pi\in\Sym(N)}\Pi\sigma\Pi^\dagger$$

	Now we verify that $\sigma'$ is indeed permutation-invariant.
	Let $\tilde{\Pi}$ be some fixed permutation, then clearly:

	$$\tilde{\Pi}\sigma'\tilde{\Pi}^\dagger=\sigma'$$

	So $\sigma'$ is permutation-invariant and we can apply \autoref{deFinetti}:

	$$\max_{\Lambda_i}\norm{\Lambda_1\otimes\ldots\otimes\Lambda_{m+n}(\sigma'-\sum_i w_i\rho_i^{\otimes n+m})}=O(\varepsilon)$$

	Note that $\tilde\sigma=\sum_i w_i\rho_i^{\otimes n+m}$ is a classical probability distribution over inputs $\rho_i^{\otimes n+m}$ with $w_i$ as weights.

	Let $p_i$ be the accept probability of at least $(\frac{1}{2}-\varepsilon)n$ copies from $\rho_i^{\otimes n}$ accept under \autoref{AlgGroundStateCheck}.
	So the accept chance of this prover is $\sum_j w_j p_j>\delta$
	By Bayes' theorem, conditioned on acceptance, the probability of $\tilde{\sigma}$ being $\ket{\rho_i^{\otimes n+m}}$ is then $\frac{w_i p_i}{\sum_j w_j p_j}$.

	Let
	$$J=\set{j:q_j\leq q'}$$

	Then the following is clearly negligible:
	$$\sum_{j\in J} w_j q_j$$

	And so is
	$$\frac{\sum_{j\in J} w_j q_j}{\sum_i w_i q_i}$$

	So by Bayes' theorem, conditioned on acceptance, the probability of $\tilde{\sigma}$ being $\rho_i^{\otimes n+m}$ where $\rho_i$ has over probability $1-2\varepsilon$ to be accepted by \autoref{AlgGroundStateCheck} is overwhelming.

	Such $\rho_i$ are $O(\poly(\varepsilon))$-close to $\ket{\psi_{C(x)}}$.

	So we simply measure the time register until we get measurement result $t\geq T$. The probability of failing to do so after all $m$ copies is $\frac{1}{2^m}$ which is negligible.
	\Ethan{Change this, since we changed the algorithm}
	
	Once we do measure $t\geq T$, the data register is guaranteed to be $O(\poly(\varepsilon))$-close to $C(x)$.

	All errors up to this point is $O(\varepsilon)$.
\end{proof}

\subsection{TODO 0 qubits}

\Ethan{Fix title}

